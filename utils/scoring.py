import numpy as np


def get_iou_vector(true: np.array, pred: np.array) -> np.ndarray:
    '''
    https://www.kaggle.com/donchuk/fast-implementation-of-scoring-metric
    '''
    batch_size = true.shape[0]
    metric = []
    for batch in range(batch_size):
        t, p = true[batch], pred[batch]
        if np.count_nonzero(t) == 0 and np.count_nonzero(p) > 0:
            metric.append(0)
            continue
        if np.count_nonzero(t) >= 1 and np.count_nonzero(p) == 0:
            metric.append(0)
            continue
        if np.count_nonzero(t) == 0 and np.count_nonzero(p) == 0:
            metric.append(1)
            continue

        intersection = np.logical_and(t, p)
        union = np.logical_or(t, p)
        iou = np.sum(intersection > 0) / np.sum(union > 0)
        thresholds = np.arange(0.5, 1, 0.05)
        s = []
        for thresh in thresholds:
            s.append(iou > thresh)
        metric.append(np.mean(s))

    return np.mean(metric)
